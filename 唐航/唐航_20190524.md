# 环境变量与文件查找

## 环境变量

### 0.变量

- 使用`declare`命令可以创建变量
  - 示例：`declare tmp`
- 使用 `=` 号赋值
- 使用 `echo` 命令和 `$` 符号读取变量的值
  - 示例：`echo $tmp`

### 1.环境变量

- 环境变量也是变量

- 每个进程都有各自的环境变量

- 环境变量的作用域是某个进程自身和它的子进程

- 当一个进程被创建时，会继承父进程的绝大部分环境变量，除非它在创建过程中明确指定

- 通常我们会涉及到的变量类型有三种：

  - 当前 Shell 进程私有用户自定义变量，如上面我们创建的 tmp 变量，只在当前 Shell 中有效
  - Shell 本身内建的变量
  - 从自定义变量导出的环境变量

- `set`，`env`，`export`命令

  - 都是用于打印环境变量信息
  - 涉及的变量范围不同

  | 命 令    | 说 明                                                        |
  | -------- | ------------------------------------------------------------ |
  | `set`    | 显示当前 Shell 所有变量，包括其内建环境变量（与 Shell 外观等相关），用户自定义变量及导出的环境变量。 |
  | `env`    | 显示与当前用户相关的环境变量，还可以让命令在指定环境中运行。 |
  | `export` | 显示从 Shell 中导出成环境变量的变量，也能通过它将自定义变量导出为环境变量。 |

  - 示例：

  ```
  temp=shiyanlou
  export temp_env=shiyanlou
  env|sort>env.txt
  export|sort>export.txt
  set|sort>set.txt
  ```

  

  - 上述操作将命令输出通过管道 | 使用 sort 命令排序，再重定向到对象文本文件中
  - 使用`vimdiff`工具可以比较导出的几个文件的内容

#### 令环境变量永久生效

- 使用`export`命令声明的变量在关闭shell时会失效
- 存储在配置文件中的变量会永久生效
- 两个重要目录
  -  `/etc/bashrc`存放shell变量
  -  `/etc/profile`存放环境变量

- 每个用户目录下有一个隐藏文件：`.profile`文件
  - 用户目录下的`.profile`文件只对当前用户永久生效
  - `/etc/profile`下的环境变量对所有用户生效

### 2.命令的查找路径与顺序

- 在shell中输入的命令是通过环境变量`PATH`来进行搜索的
-  `PATH` 里面保存了 Shell 中执行的命令的搜索路径
- 查看`PATH`环境变量的内容：`echo $PATH`
- 通常`PATH`的目录下存放的都是可执行文件

### 3.添加自定义命令到`PATH`环境变量

- `PATH`中的命令以`:`作为分割符
- 添加自定义路径(临时)：`PATH = $PATH:自定义路径`
  - 示例：`PATH=$PATH:/home/shiyanlou/mybin`
  - 一定要使用绝对路径
- 添加自定义路径(永久)
  - 每个用户的 home 目录中有一个 Shell 每次启动时会默认执行配置脚本，用于初始化环境
    - Bash 的配置文件为`.bashrc`
    - zsh 的配置文件是 `.zshrc`
  - 将上面临时设置环境变量的命令添加到配置文件中可以自动配置环境变量
    - 示例：`echo "PATH=$PATH:/home/shiyanlou/mybin" >> .zshrc`
    - 上述命令中>>表示将标准输出以追加的方式重定向到一个文件中
    - \>是以覆盖的方式重定向到一个文件中
    - 在指定文件不存在的情况下都会创建新的文件

### 4. 修改和删除已有变量

#### 变量修改

- 变量的修改有以下几种方式：

| 变量设置方式                   | 说明                                         |
| ------------------------------ | -------------------------------------------- |
| `${变量名#匹配字串}`           | 从头向后开始匹配，删除符合匹配字串的最短数据 |
| `${变量名##匹配字串}`          | 从头向后开始匹配，删除符合匹配字串的最长数据 |
| `${变量名%匹配字串}`           | 从尾向前开始匹配，删除符合匹配字串的最短数据 |
| `${变量名%%匹配字串}`          | 从尾向前开始匹配，删除符合匹配字串的最长数据 |
| `${变量名/旧的字串/新的字串}`  | 将符合旧字串的第一个字串替换为新的字串       |
| `${变量名//旧的字串/新的字串}` | 将符合旧字串的全部字串替换为新的字串         |

- 示例

```
path=$PATH
echo $path
path=${path%/home/shiyanlou/mybin}
# 或使用通配符,*表示任意多个任意字符
path=${path%*/mybin}
```



#### 变量删除

- 可以使用 unset 命令删除一个环境变量：
  - 示例：`unset temp`

### 5.如何让环境变量立即生效

- 修改配置文件后可以使用`source`命令来让其立即生效

  - 示例：

  ```
  cd /home/shiyanlou
  source .zshrc
  ```

- `source` 命令还有一个别名就是 `.`，上面的命令如果替换成 `.` 的方式就该是：`. ./.zshrc`

  - 在使用.的时候，需要注意与表示当前路径的那个点区分开
  - 注意第一个点后面有一个空格，而且后面的文件必须指定完整的绝对或相对路径名，`source`则不需要

## 搜索文件

与搜索相关的命令常用的有 `whereis`，`which`，`find` 和 `locate`

- **`whereis` 简单快速**

  - 格式：`whereis 目录名`
  - 示例

  ```
  $ whereis who
  $ whereis find
  ```

  - `whereis` 并不从硬盘中依次查找，而是直接从数据库中查询
  - `whereis` 只能搜索二进制文件(-b)，man 帮助文件(-m)和源代码文件(-s)
  - 如果想要获得更全面的搜索结果可以使用 `locate` 命令。

- **locate 快而全**
  - 通过` /var/lib/mlocate/mlocate.db `数据库查找
    - 这个数据库不是实时更新的
    - 系统会使用定时任务每天自动执行 `updatedb` 命令更新一次
    - 有时候刚添加的文件，可能会找不到，需要手动执行一次 `updatedb` 命令
  - 可以用来查找指定目录下的不同文件类型，如查找 /etc 下所有以 sh 开头的文件：

  ```
  $ sudo apt-get update
  $ sudo apt-get install locate
  $ locate /etc/sh
  ```

  - 它不只是在 /bin 目录下查找，还会自动递归子目录进行查找

  - 示例：查找 /usr/share/ 下所有 jpg 文件：

    ```
    $ locate /usr/share/\*.jpg
    ```
    - 要添加 \* 号前面的反斜杠转义，否则会无法找到

  - 如果想只统计数目可以加上 `-c` 参数

  - `-i` 参数可以忽略大小写进行查找

  - `whereis`的 `-b`、`-m`、`-s` 同样可以使用。

- **which 小而精**
  - `which` 是 Shell 内建的一个命令
  - 只从 `PATH` 环境变量指定的路径中去搜索命令
  - 我们通常使用 `which` 来确定是否安装了某个指定的软件：

```
$ which man
```

- **find 精而细**
  - 是这几个命令中最强大的

  - 不但可以通过文件类型、文件名进行查找而且可以根据文件的属性（如文件的时间戳，文件的权限等）进行搜索

  -  find 命令的路径是作为第一个参数的， 基本命令格式为 find [path] [option] [action] 

  - 示例

    ```
    $ sudo find /etc/ -name interfaces
    ```

    - 这条命令表示去 /etc/ 目录下面 ，搜索名字叫做 interfaces 的文件或者目录

  - 与时间相关的命令参数：

    | 参数     | 说明                   |
    | -------- | ---------------------- |
    | `-atime` | 最后访问时间           |
    | `-ctime` | 最后修改文件内容的时间 |
    | `-mtime` | 最后修改文件属性的时间 |

  - 以 `-mtime` 参数举例：
    - `-mtime n`：n 为数字，表示为在 n 天之前的“一天之内”修改过的文件
    - `-mtime +n`：列出在 n 天之前（不包含 n 天本身）被修改过的文件
    - `-mtime -n`：列出在 n 天之内（包含 n 天本身）被修改过的文件
    - `-newer file`：file 为一个已存在的文件，列出比 file 还要新的文件名

  - 列出 home 目录中，当天（24 小时之内）有改动的文件：

  ```
  $ find ~ -mtime 0
  ```

  - 列出用户家目录下比 Code 文件夹新的文件：

  ```
  $ find ~ -newer /home/shiyanlou/Code
  ```

## 作业

- 找出 /etc/ 目录下的所有以 .list 结尾的文件
  - `find /etc/ -name \*.list`

